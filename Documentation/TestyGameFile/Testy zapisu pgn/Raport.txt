Raport dla testow z zapisu gry do pgn.

1. Przebieg

 Test polega na odtworzeniu kilku partii zapisanych w folderze testy, na ktorych testowane bylo wczesniej wczytywanie partii. Sprawdzana jest poprawnosc zapisu partii do pliku pgn, a przy okazji ma byc sprawdzana poprawnosc kazdego ruchu, np. czy krol moze poruszyc sie na szachowane pole.

2. Test nr 1

 Odtworzenie gry z pliku test2 (oryginalna partia to gra 6 z mistrzostw swiata 2021). Podczas rozgrywania partii kazdy ruch mogl zostac poprawnie odczytany, ponadto w kazdym przypadku szachowania krola, mogl on poruszac sie on jedynie na dozwolone pola, oraz kazda figura mogla wykonywac ruchy jedynie na dozwolone pola. Gra zakonczyla sie (jak w oryginale) przez poddanie ze strony czarnych.
Po zakonczeniu, w pliku pgn pojawil sie nastepujacy zapis:

1. d4 Ngf6 2. Ngf3 d5 3. g3 e6 4. Bfg2 Bfe7 5. 0-0 0-0 6. b3 c5 7. dxc5 Bxc5 8. c4 dxc4 9. Qc2 Qe7 10. Nd2 Nc6 11. Nxc4 b5 12. Ne5 Ncb4 13. Qb2 B8b7 14. a3 Nc6 15. Nd3 Bb6 16. Bg5 Rfd8 17. B5xf6 gxf6 18. Rac1 Nd4 19. Nfxd4 B6xd4 20. Qa2 Bxg2 21. Kxg2 Qb7 22. Kg1 Qe4 23. Qc2 a5 24. Rfd1 Kg7 25. Rdd2 Rac8 26. Qxc8 Rxc8 27. Rxc8 Qd5 28. b4 a4 29. e3 Be5 30. h4 h5 31. Kh2 Bb2 32. Rc5 Qd6 33. Rd1 Bxa3 34. Rxb5 Qd7 35. Rc5 e5 36. Rc2 Qd5 37. Rd2 Qb3 38. Rca2 e4 39. Nc5 Qxb4 40. Nxe4 Qb3 41. Rac2 Bf8 42. Nc5 Qb5 43. Nd3 a3 44. Nf4 Qa5 45. Rca2 Bb4 46. Rdd3 Kh6 47. Rd1 Qa4 48. Ra1 Bd6 49. Kg1 Qb3 50. Ne2 Qd3 51. Nd4 Kh7 52. Kh2 Qe4 53. R2xa3 Qxh4 54. Kg2 54. Qg5 Kh2 55. Qh4 Kg1 56. Qe4 R3a4 57. Be5 Ne2 58. Qc2 R1a2 59. Qb3 Kg2 60. Qd5 f3 61. Qd1 f4 62. Bc7 Kf2 63. Bb6 R2a1 64. Qb3 R4e4 65. Kg7 Re8 66. f5 Ra8 67. Qb4 Rac8 68. Ba5 Rcc1 69. Bb6 Re5 70. Qb3 Re8 71. Qd5 Rc8 72. Qh1 Rcc1 73. Qd5 Rb1 74. Ba7 Re7 75. Bc5 Re5 76. Qd3 Rb7 77. Qc2 Rb5 78. Ba7 Rba5 79. Bb6 Rab5 80. Ba7 Rexf5 81. Qd3 Rfxf7 82. Kxf7 Rb7 83. Kg6 Rxa7 84. Qd5 Ra6 85. Kh7 Ra1 86. Kg6 Nd4 87. Qb7 Ra2 88. Qh1 Ra6 89. Kf7 Nf3 90. Qb1 Rd6 91. Kg7 Rd5 92. Qa2 Rd2 93. Qb1 Re2 94. Qb6 Rc2 95. Qb1 Nd4 96. Qh1 Rc7 97. Kf6 Rc6 98. Kf7 Nf3 99. Qb1 Ng5 100. Kg7 Ne6 101. Kf7 Nd4 102. Qh1 Rc7 103. Kf6 Nf3 104. Qb1 Rd7 105. Qb2 Rd2 106. Qb1 Ng1 107. Qb4 Rd1 108. Qb3 Rd6 109. Kg7 Rd4 110. Qb2 Ne2 111. Qb1 e4 112. Qh1 Rd7 113. Kg8 Rd4 114. Qh2 Ke3 115. h4 gxh4 116. Qh3 Kd2 117. Qxh4 Rd3 118. Kf8 Rf3 119. Qd8 Ke3 120. Qa5 Kf2 121. Qa7 Re3 122. Qd7 Ng3 123. Qd2 Kf3 124. Qd1 Re2 125. Qb3 Kg2 126. Qb7 Rd2 127. Qb3 Rd5 128. Ke7 Re5 129. Kf7 Rf5 130. Ke8 e5 131. Qa2 Kh3 132. Qe6 Kh4 133. Qh6 Nh5 134. Qh7 e6 135. Qg6 Rf7 136. Kd8 f5 137. Qg1 Ng7 1-0

ktory jest zgodny z konwencja, jaka przyjelismy przy ustalaniu zasad zapisu do pgn. W pewnym momencie jednak w trakcie testu krol zostal przesuniety przeze mnie na zle pole, przez co musialem wykonac 2 ruchy korygujace, aby partia mogla sie zakonczyc w ten sam sposob. Przy tej okazji jednak cofnalem ruch, aby zobaczyc co sie stalo i okazalo sie to kluczowe do znalezienia bledu przy zapisie ruchu 54, gdzie numer ruchu wystepuje 2 razy, a nastepnie kazdy ruch jest "przesuniety" o jeden.
Stalo sie tak, z powodu uzycia pola counter z gameSupervisor podczas zapisu do formatu pgn. W momencie cofniecia ruchu, metoda retraceMove modyfikuje pole counter, co pozniej jest zmieniane podczas metody resolveMove, jednak, co istotne dla naszego zapisu, jest to wykonywane przez metode realSize, ktora zwraca rozmiar gry, jednak zmniejszony o 1, w efekcie czego counter jest o 1 mniejszy niz zaklada to funkcja zapisujaca, co powoduje blad. Prostym sposobem naprawienia tego bledu byla zamiana pola counter na game.size(), ktore zwraca rozmiar tablicy, ktora trzyma ruchy, dzieki czemu nie ma mozliwosci, aby zostala ona sztucznie zmodyfikowana, bo dodajemy elementy do tablicy wtw, gdy zapisujemy tez do pliku.

Test nr 2

Odtworzenie gry z pliku test3 (gra 6 z mistrzostw ?wiata pomi?dzy Fischerem i Spasskim z 1972 roku). Ca?a partia wczytana poprawnie, wszystkie pod?wietlane pola dla figur poprawne. Zapis z pliku:
1. c4 e6 2. Ngf3 d5 3. d4 Ngf6 4. Nc3 Bfe7 5. Bcg5 0-0 6. e3 h6 7. Bh4 b6 8. cxd5 Nxd5 9. Bxe7 Qxe7 10. Ncxd5 exd5 11. Rac1 Be6 12. Qa4 c5 13. Qa3 Rfc8 14. Bb5 a6 15. dxc5 bxc5 16. 0-0 Raa7 17. Be2 Nd7 18. Nd4 Qf8 19. Nxe6 fxe6 20. e4 d4 21. f4 Qe7 22. e5 Rb8 23. Bc4 Kh8 24. Qh3 Nf8 25. b3 a5 26. f5 exf5 27. Rfxf5 Nh7 28. Rf1 Qd8 29. Qg3 Re7 30. h4 Rb7 31. e6 Rbc7 32. Qe5 Qe8 33. a4 Qd8 34. R1f2 Qe8 35. R2f3 Qd8 36. Bd3 Qe8 37. Qe4 Nf6 38. R5xf6 gxf6 39. Rxf6 Kg8 40. Bc4 Kh8 41. Qf4 1-0
zgodny z konwencj? (jednoznaczny), wyst?puj? jedynie minimalne ró?nice nie powoduj?ce wieleznaczno?ci zpaisu. Przy okazji sprawdzi?em b??d, który pojawi? si? w poprzednim te?cie i tym razem, dzi?ki poprawce w kodzie, nie wyst?pi?.
